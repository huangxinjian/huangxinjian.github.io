(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{235:function(a,s,e){"use strict";e.r(s);var t=e(28),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"kafka-集群搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-集群搭建"}},[a._v("#")]),a._v(" Kafka 集群搭建")]),a._v(" "),e("blockquote",[e("p",[a._v("以下环境均在 vmware centerOS7 中搭建")])]),a._v(" "),e("p",[a._v("下面详细讲解一下 Kafka 的集群搭建，首先我们需要下载 Kakfa，由于国内的网速比较慢，推荐使用清华大学的镜像：")]),a._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.2.1/kafka_2.12-2.2.1.tgz\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"安装并配置第一台主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装并配置第一台主机"}},[a._v("#")]),a._v(" 安装并配置第一台主机")]),a._v(" "),e("p",[a._v("下载完成后，我们进行解压缩")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/kafkaSetup1.jpg",alt:"kafkaSetup1"}})]),a._v(" "),e("p",[a._v("为了方便我们使用，我们可以为 kafka 创建一个不带版本号的"),e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("软连接")])]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/kafkaSetup2.jpg",alt:"kafkaSetup2"}})]),a._v(" "),e("p",[a._v("解压完成后，我们需要修改 kafka 下的 "),e("code",[a._v("config/server.properties")]),a._v(" 配置文件，其中需要修改的内容有：")]),a._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka 服务器id")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("broker.id")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("0")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka 对外提供的端口, socket 服务器会监听该端口")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("listener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("PLAINTEXT://192.168.59.122:9092")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置 zookeeper 的地址")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("zookeeper.connect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("192.168.59.117:2181")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br")])]),e("h2",{attrs:{id:"克隆两台主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#克隆两台主机"}},[a._v("#")]),a._v(" 克隆两台主机")]),a._v(" "),e("p",[a._v("通过 VMVare 克隆两台一模一样的主机，然后修改对应的 "),e("code",[a._v("server.properties")]),a._v(" 文件")]),a._v(" "),e("blockquote",[e("p",[a._v("注意，Zookeeper 地址不需要修改，因为它们是同一个集群下的 kafka broker")])]),a._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka 服务器id")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("broker.id")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("别的id")]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka 对外提供的端口, socket 服务器会监听该端口")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("listener")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("PLAINTEXT://别的ip:9092")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h2",{attrs:{id:"kafka-的启动与停止"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-的启动与停止"}},[a._v("#")]),a._v(" Kafka 的启动与停止")]),a._v(" "),e("p",[a._v("首先要明确，对于 kafka 的一些命令，我们并不需要记住，这些在官方文档上都可以查阅："),e("a",{attrs:{href:"http://kafka.apache.org/quickstart",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方地址"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"启动-zookeeper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动-zookeeper"}},[a._v("#")]),a._v(" 启动 Zookeeper")]),a._v(" "),e("p",[a._v("在 "),e("RouterLink",{attrs:{to:"/distributed/messageSystem/Kafka/Kafka介绍.html#zookeeper-for-kafka"}},[a._v("Kafka 介绍")]),a._v(" 中，我们提到了 Zookeeper 对于 kafka 的作用，可以认为，kafka 其实就是 Zookeeper 的客户端。")],1),a._v(" "),e("p",[a._v("因此，我们在启动 kafka 之前，需要先启动 zookeeper, 如果是使用 kafka 内置的 zookeeper，可以这样启动")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/zookeeper-server-start.sh config/zookeeper.properties\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("如果是自己另外配置了一台 zookeeper，就去到那台机器下启动：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("zkServer.sh start\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"启动-kafka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动-kafka"}},[a._v("#")]),a._v(" 启动 Kafka")]),a._v(" "),e("p",[a._v("然后我们启动 Kafka Server")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-server-start.sh config/server.properties\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("注意这样启动有个问题，就是我们当前的命令行窗口会进入阻塞状态，无法再输入别的命令")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/kafkaStart1.jpg",alt:"启动1"}})]),a._v(" "),e("p",[a._v("所以我们需要让 kafka 以守护进程的方式启动，需要添加参数 "),e("code",[a._v("-daemon")]),a._v(" ：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-server-start.sh -daemon config/server.properties\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("启动后可以通过 "),e("code",[a._v("ps")]),a._v(" 命令查看 kafka 进程是否存在：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" aux "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" kafka\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"停止-kafka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止-kafka"}},[a._v("#")]),a._v(" 停止 Kafka")]),a._v(" "),e("p",[a._v("如果需要停止 Kafka，可执行以下脚本")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-server-stop.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"kafka-操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-操作"}},[a._v("#")]),a._v(" Kafka 操作")]),a._v(" "),e("p",[a._v("首先要明确，对于 kafka 的一些命令，我们并不需要记住，这些在官方文档上都可以查阅："),e("a",{attrs:{href:"http://kafka.apache.org/quickstart",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方地址"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"创建-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-topic"}},[a._v("#")]),a._v(" 创建 topic")]),a._v(" "),e("p",[a._v("下面创建一个名为 "),e("code",[a._v("test")]),a._v(" 的 topic")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --partitions "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" --topic country\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("其中：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("--bootstrap-server")]),a._v(" 代表我们要将请求发给哪台 kafka 服务器处理，因为需要将 localhost 替换为对应的 IP 地址")]),a._v(" "),e("li",[e("code",[a._v("--partitions")]),a._v(" 代表这个 topic 有多少个分区")]),a._v(" "),e("li",[e("code",[a._v("--Replication-factor")]),a._v(" 代表这个 topic 的每个分区有多少个副本")])]),a._v(" "),e("p",[a._v("例如我们这里创建了 3 个分区，就会在三台机器中的 "),e("code",[a._v("/tmp/kafka-logs")]),a._v(" 文件夹中随机生成：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("country-1")])]),a._v(" "),e("li",[e("code",[a._v("country-2")])]),a._v(" "),e("li",[e("code",[a._v("country-3")])])]),a._v(" "),e("p",[a._v("这三个文件夹，"),e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("这个文件夹就是 "),e("code",[a._v("partition")]),a._v(" 分区")]),a._v("。")]),a._v(" "),e("p",[a._v("然后我们设置了 "),e("code",[a._v("--partitions 2")]),a._v(" ，就是说每个分区都会存在一个副本，并且两个相同分区之间存在 "),e("code",[a._v("leader")]),a._v(" 和 "),e("code",[a._v("follower")]),a._v(" 的关系。")]),a._v(" "),e("p",[a._v("另外，这些副本存在哪一台机器上也是随机的。有可能机器 A 是 "),e("code",[a._v("country-1")]),a._v(" 和 "),e("code",[a._v("country-0")]),a._v(" ，机器 B 是 "),e("code",[a._v("country-1")]),a._v(" 和 "),e("code",[a._v("country-2")]),a._v("，机器 C 是 "),e("code",[a._v("country-0")]),a._v("、"),e("code",[a._v("country-2")]),a._v("。 这些都是由 Zookeeper 进行配对的。")]),a._v(" "),e("h3",{attrs:{id:"查看-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-topic"}},[a._v("#")]),a._v(" 查看 topic")]),a._v(" "),e("p",[a._v("创建完成后，结果可以通过如下命令查询：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-topics.sh --list --bootstrap-server localhost:9092\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("结果如下：")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/kafkacreatetopic.jpg",alt:"结果"}})]),a._v(" "),e("h3",{attrs:{id:"删除-topic"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除-topic"}},[a._v("#")]),a._v(" 删除 topic")]),a._v(" "),e("p",[a._v("如果我们需要删除某个 topic ，可以执行这条命令")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-topics.sh --delete --bootstrap-server "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".59.122:9092 --topic country\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看分区配对信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看分区配对信息"}},[a._v("#")]),a._v(" 查看分区配对信息")]),a._v(" "),e("p",[a._v("前面说到，每个分区会随机分配给集群中的机器，如果存在副本集，也是随机分配的，并且同一分区中的多个集合存在 "),e("code",[a._v("Leader - Follower")]),a._v(" 关系。")]),a._v(" "),e("p",[a._v("对此，我们可以通过以下命令进行查询：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" bin/kafka-topics.sh --describe --bootstrap-server "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".59.122:9092 --topic country\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("输出结果：")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/kafka-topic-describe.png",alt:"kafka配对信息"}})]),a._v(" "),e("h3",{attrs:{id:"发送消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[a._v("#")]),a._v(" 发送消息")]),a._v(" "),e("p",[a._v("创建好 Topic 后，我们就可以通过 "),e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("生产者")]),a._v(" 来生产消息了。")]),a._v(" "),e("p",[a._v("创建生产者的命令如下：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-console-producer.sh --broker-list "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".59.121:9092 --topic country\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("然后就可以发送消息了")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" bin/kafka-console-producer.sh --broker-list "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".59.121:9092 --topic country\nThis is a message\nThis is another message\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h3",{attrs:{id:"消费消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消费消息"}},[a._v("#")]),a._v(" 消费消息")]),a._v(" "),e("p",[a._v("既然我们通过生产者生产出消息并发送到 Kafka 中，相对应我们也需要通过 "),e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("消费者")]),a._v(" 来消费消息。")]),a._v(" "),e("p",[a._v("创建消费者的命令如下：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic country\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("执行完这条命令后，命令行窗口就会进入"),e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("监听状态")]),a._v("。此时生产者继续生产消息，消费者可以马上接受到。")]),a._v(" "),e("p",[e("strong",{staticStyle:{color:"#3EAF7C"}},[a._v("如果需要消费一些在消费者创建之前，生产者就已经发送了的消息，可以通过添加选项 "),e("code",[a._v("--from-beginning")])]),a._v("。例如：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic country --from-beginning\nThis is a message\nThis is another message\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h2",{attrs:{id:"kafka-日志查看"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kafka-日志查看"}},[a._v("#")]),a._v(" Kafka 日志查看")]),a._v(" "),e("p",[a._v("这里要查看的是 Kafka 的运行日志，而不是启动日志，在运行日志中，我们可以看到 kafka 中 Topic 的各个分区信息")])])}),[],!1,null,null,null);s.default=r.exports}}]);