<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL 索引详细分析 | HuangXinJian</title>
    <meta name="description" content="If you learn, learn deeply please!">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/H.png">
    
    <link rel="preload" href="/assets/css/0.styles.77838d5e.css" as="style"><link rel="preload" href="/assets/js/app.78cba7d9.js" as="script"><link rel="preload" href="/assets/js/2.b97de27f.js" as="script"><link rel="preload" href="/assets/js/11.fc6bddf2.js" as="script"><link rel="prefetch" href="/assets/js/10.5a39f9cf.js"><link rel="prefetch" href="/assets/js/12.da1eaab3.js"><link rel="prefetch" href="/assets/js/13.3e791f4e.js"><link rel="prefetch" href="/assets/js/14.5953a388.js"><link rel="prefetch" href="/assets/js/15.b9e792e3.js"><link rel="prefetch" href="/assets/js/16.14be3228.js"><link rel="prefetch" href="/assets/js/17.d8c48abe.js"><link rel="prefetch" href="/assets/js/18.c1171d86.js"><link rel="prefetch" href="/assets/js/19.687638f3.js"><link rel="prefetch" href="/assets/js/20.dbb7c712.js"><link rel="prefetch" href="/assets/js/21.fcac9d7b.js"><link rel="prefetch" href="/assets/js/22.05c89a82.js"><link rel="prefetch" href="/assets/js/23.6f455ef9.js"><link rel="prefetch" href="/assets/js/24.a5f5dd42.js"><link rel="prefetch" href="/assets/js/25.ddacf5f1.js"><link rel="prefetch" href="/assets/js/26.1dbabccd.js"><link rel="prefetch" href="/assets/js/27.4d3ddddd.js"><link rel="prefetch" href="/assets/js/28.aca93b2e.js"><link rel="prefetch" href="/assets/js/29.4e592fcf.js"><link rel="prefetch" href="/assets/js/3.8c3b122e.js"><link rel="prefetch" href="/assets/js/30.07e05cf0.js"><link rel="prefetch" href="/assets/js/31.4bc393d7.js"><link rel="prefetch" href="/assets/js/32.5bed9ede.js"><link rel="prefetch" href="/assets/js/33.b1d61159.js"><link rel="prefetch" href="/assets/js/34.27c7f1f1.js"><link rel="prefetch" href="/assets/js/35.17c92a26.js"><link rel="prefetch" href="/assets/js/36.91a5ecf5.js"><link rel="prefetch" href="/assets/js/37.88c250af.js"><link rel="prefetch" href="/assets/js/38.6d72295b.js"><link rel="prefetch" href="/assets/js/39.0e585af1.js"><link rel="prefetch" href="/assets/js/4.ff5f2a88.js"><link rel="prefetch" href="/assets/js/40.80a7f1c2.js"><link rel="prefetch" href="/assets/js/41.defa3efa.js"><link rel="prefetch" href="/assets/js/42.70857ada.js"><link rel="prefetch" href="/assets/js/5.68065b24.js"><link rel="prefetch" href="/assets/js/6.bb2aa06c.js"><link rel="prefetch" href="/assets/js/7.f469350c.js"><link rel="prefetch" href="/assets/js/8.37ca51cf.js"><link rel="prefetch" href="/assets/js/9.68f4fa83.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77838d5e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HuangXinJian</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/NodeJS基础/NodeJS介绍.html" class="nav-link">
  NodeJS 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/baseJava/Java 介绍.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/frameworkHistory/架构演变历史.html" class="nav-link">
  分布式学习路线
</a></li><li class="dropdown-item"><!----> <a href="/distributed/registerCenter/" class="nav-link">
  注册中心
</a></li><li class="dropdown-item"><!----> <a href="/distributed/messageSystem/" class="nav-link">
  消息系统
</a></li><li class="dropdown-item"><!----> <a href="/distributed/internal/" class="nav-link">
  网络框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/RDB/MySQL_Learn/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxinjian/huangxinjian.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/NodeJS基础/NodeJS介绍.html" class="nav-link">
  NodeJS 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/baseJava/Java 介绍.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/frameworkHistory/架构演变历史.html" class="nav-link">
  分布式学习路线
</a></li><li class="dropdown-item"><!----> <a href="/distributed/registerCenter/" class="nav-link">
  注册中心
</a></li><li class="dropdown-item"><!----> <a href="/distributed/messageSystem/" class="nav-link">
  消息系统
</a></li><li class="dropdown-item"><!----> <a href="/distributed/internal/" class="nav-link">
  网络框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/RDB/MySQL_Learn/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxinjian/huangxinjian.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MySQL</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/RDB/MySQL_Learn/MySQL安装.html" class="sidebar-link">MySQL 单机安装</a></li><li><a href="/database/RDB/MySQL_Learn/MySQL基础语法.html" class="sidebar-link">MySQL 基础语法</a></li><li><a href="/database/RDB/MySQL_Learn/MySQL架构.html" class="sidebar-link">MySQL 架构</a></li><li><a href="/database/RDB/MySQL_Learn/MySQL索引.html" class="sidebar-link">MySQL 索引</a></li><li><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html" class="active sidebar-link">MySQL 索引详细分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引的使用场景" class="sidebar-link">索引的使用场景</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引执行计划" class="sidebar-link">索引执行计划</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#id" class="sidebar-link">id</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#select-type-重要" class="sidebar-link">select_type 💥 重要</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#simple" class="sidebar-link">simple</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#primary" class="sidebar-link">primary</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#subquery" class="sidebar-link">subquery</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#dependent-subquery" class="sidebar-link">dependent subquery</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#union" class="sidebar-link">union</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#dependent-union" class="sidebar-link">dependent union</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#union-result" class="sidebar-link">union result</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#derived" class="sidebar-link">derived</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#table" class="sidebar-link">table</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#type-重要" class="sidebar-link">type 💥 重要</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#system" class="sidebar-link">system</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#const-重要" class="sidebar-link">const 👍 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#eq-ref-重要" class="sidebar-link">eq_ref 👍 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#ref-重要" class="sidebar-link">ref 👍 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#fulltext" class="sidebar-link">fulltext</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#ref-or-null" class="sidebar-link">refornull</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#unique-subquery" class="sidebar-link">unique_subquery</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#index-subquery" class="sidebar-link">index_subquery</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#range-重要" class="sidebar-link">range 💥 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#index-重要" class="sidebar-link">index 👍 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#all-重要" class="sidebar-link">all 👍 重要</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#possible-keys" class="sidebar-link">possible keys</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#key" class="sidebar-link">key</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#key-len" class="sidebar-link">key len</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#ref" class="sidebar-link">ref</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#rows" class="sidebar-link">rows</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#filtered" class="sidebar-link">filtered</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#extra-重要" class="sidebar-link">extra 💥 重要</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#no-tables-used" class="sidebar-link">no tables used</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#using-filesort" class="sidebar-link">using filesort</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#using-index" class="sidebar-link">using index</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#using-temporary" class="sidebar-link">using temporary</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#using-where-重要" class="sidebar-link">using where 💥 重要</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#using-index-condition-重要" class="sidebar-link">using index condition 💥 重要</a></li></ul></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#mysql-索引失效分析" class="sidebar-link">MySQL 索引失效分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#全局匹配我最爱" class="sidebar-link">全局匹配我最爱</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#最佳左前缀法则" class="sidebar-link">最佳左前缀法则</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#不要在索引上做计算" class="sidebar-link">不要在索引上做计算</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#范围条件右边的列失效" class="sidebar-link">范围条件右边的列失效</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#尽量使用覆盖索引" class="sidebar-link">尽量使用覆盖索引</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引字段上不要使用不等" class="sidebar-link">索引字段上不要使用不等</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#主键索引上不能使用带有-null-的判断" class="sidebar-link">主键索引上不能使用带有 null 的判断</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引字段使用like不以通配符开头" class="sidebar-link">索引字段使用like不以通配符开头</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引字段是字符串需要带单引号" class="sidebar-link">索引字段是字符串需要带单引号</a></li><li class="sidebar-sub-header"><a href="/database/RDB/MySQL_Learn/MySQL索引详细分析.html#索引字段不要使用or" class="sidebar-link">索引字段不要使用or</a></li></ul></li></ul></li><li><a href="/database/RDB/MySQL_Learn/MySQL锁.html" class="sidebar-link">MySQL 锁</a></li><li><a href="/database/RDB/MySQL_Learn/MySQL事务.html" class="sidebar-link">MySQL 事务</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-索引详细分析"><a href="#mysql-索引详细分析" class="header-anchor">#</a> MySQL 索引详细分析</h1> <h2 id="索引的使用场景"><a href="#索引的使用场景" class="header-anchor">#</a> 索引的使用场景</h2> <p>通常在哪些地方需要建立索引呢？有以下几个参考点：</p> <ol><li>主键自动建立唯一非空索引</li> <li>对于某些字段业务查询十分频繁的，可以考虑建立索引</li> <li>在多表关联查询中，关联表两边应该创建索引，对于 <code>on</code> 条件的两边也应该创建索引</li> <li>在查询中用于排序的字段，可以考虑创建索引，因为 <code>B+ Tree</code> 是有顺序的</li> <li>统计查询或分组查询，应该创建索引</li></ol> <p>哪些情况下不需要创建索引呢，也可以参考：</p> <ol><li>表中记录较少的，不需要创建索引，因为索引也会占据一定的存储空间</li> <li>表中的记录需要进行频繁的更新的，不适合建立索引，这样会增加索引的维护成本</li> <li>查询的字段使用频率不高的，不需要创建索引</li></ol> <h2 id="索引执行计划"><a href="#索引执行计划" class="header-anchor">#</a> 索引执行计划</h2> <p>MySQL 中提供了一个 <code>explain</code> 的命令让我们分析 SQL 的执行计划，从而判断这个 SQL 语句有没有走索引，或者是不是走得最优的索引。</p> <p>这个命令一共提供了10个参数来分析 SQL ：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>id、select_type、table、type、possible_keys、key、key_len、ref、rows、Extra
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面根据案例，来详解各个参数的含义，初始化表如下：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">--用户表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> tuser<span class="token punctuation">(</span>
id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
loginname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  
name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
age <span class="token keyword">int</span><span class="token punctuation">,</span>
sex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
dep <span class="token keyword">int</span><span class="token punctuation">,</span>  
address <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--部门表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> tdep<span class="token punctuation">(</span>
id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--地址表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> taddr<span class="token punctuation">(</span>
id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
addr <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--测试</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> test<span class="token punctuation">(</span>
id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
<span class="token keyword">user</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--创建普通索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> tuser <span class="token keyword">add</span> <span class="token keyword">index</span> idx_dep<span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--创建唯一索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> tuser <span class="token keyword">add</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> idx_loginname<span class="token punctuation">(</span>loginname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--创建组合索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> tuser <span class="token keyword">add</span> <span class="token keyword">index</span> idx_name_age_sex<span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--创建全文索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> taddr <span class="token keyword">add</span> fulltext ft_addr<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="id"><a href="#id" class="header-anchor">#</a> id</h2> <p>这个参数指明了 SQL 的执行顺序，一共有三种情况：</p> <ul><li><code>id</code> 相同的话，执行顺序是由上往下</li> <li><code>id</code> 不同的话，<strong style="color:#3EAF7C;">id值越大的越先执行</strong>。</li> <li><code>id</code> 为 <code>NULL</code> 的话，表示这个值是一个结果集，不需要继续执行。</li></ul> <h2 id="select-type-重要"><a href="#select-type-重要" class="header-anchor">#</a> select_type 💥 重要</h2> <p>这个参数指明的是查询类型，用来区别 <code>普通查询</code>、<code>联合查询(union、union all)</code>、<code>子查询</code> 等其它复杂查询。</p> <h3 id="simple"><a href="#simple" class="header-anchor">#</a> simple</h3> <p>如果值为 <code>simple</code> ，就表示这是一个<strong style="color:#3EAF7C;">不需要<code>union</code>操作和子查询操作</strong>的简单select查询，当有连接查询的，外层的查询就是 <code>simple</code>：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> explain <span class="token keyword">select</span> * from tuser<span class="token punctuation">;</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> tuser <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL  <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="primary"><a href="#primary" class="header-anchor">#</a> primary</h3> <p>当存在 <code>union</code> 或 <code>子查询</code> 时，位于最外层的查询语句的 <code>select_type</code> 就是 <code>primary</code>，并且只有一个。</p> <p>使用 <code>union</code> 查询</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> explain <span class="token keyword">select</span> * from tdep where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span> union <span class="token keyword">select</span> * from tdep where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
+----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type  <span class="token operator">|</span> table      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra           <span class="token operator">|</span>
+----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY      <span class="token operator">|</span> tdep       <span class="token operator">|</span> NULL       <span class="token operator">|</span> const <span class="token operator">|</span> PRIMARY       <span class="token operator">|</span> PRIMARY <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL            <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> UNION        <span class="token operator">|</span> tdep       <span class="token operator">|</span> NULL       <span class="token operator">|</span> const <span class="token operator">|</span> PRIMARY       <span class="token operator">|</span> PRIMARY <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL            <span class="token operator">|</span>
<span class="token operator">|</span> NULL <span class="token operator">|</span> UNION RESULT <span class="token operator">|</span> <span class="token operator">&lt;</span>union1,<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL   <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL  <span class="token operator">|</span> NULL <span class="token operator">|</span>     NULL <span class="token operator">|</span> Using temporary <span class="token operator">|</span>
+----+--------------+------------+------------+-------+---------------+---------+---------+-------+------+----------+-----------------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>子查询的：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> explain <span class="token keyword">select</span> * from tdep where <span class="token function">id</span> <span class="token operator">=</span> <span class="token punctuation">(</span>select <span class="token function">id</span> from tuser where <span class="token function">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY     <span class="token operator">|</span> tdep  <span class="token operator">|</span> NULL       <span class="token operator">|</span> const <span class="token operator">|</span> PRIMARY       <span class="token operator">|</span> PRIMARY <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL        <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> SUBQUERY    <span class="token operator">|</span> tuser <span class="token operator">|</span> NULL       <span class="token operator">|</span> const <span class="token operator">|</span> PRIMARY       <span class="token operator">|</span> PRIMARY <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using index <span class="token operator">|</span>
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="subquery"><a href="#subquery" class="header-anchor">#</a> subquery</h3> <p>除了 <code>from</code> 字句中包含的子查询外，其他地方出现的子查询都可能是 <code>subquery</code>，对于 <code>from</code> 子句中包含时，会显示 <code>simple</code> ：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> explain <span class="token keyword">select</span> * from <span class="token punctuation">(</span>select * from tuser<span class="token punctuation">)</span> a<span class="token punctuation">;</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type <span class="token operator">|</span> table <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> SIMPLE      <span class="token operator">|</span> tuser <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL  <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> NULL  <span class="token operator">|</span>
+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="dependent-subquery"><a href="#dependent-subquery" class="header-anchor">#</a> dependent subquery</h3> <p>与 <code>dependent union</code> 类似，表示这个 <code>subquery</code> 的查询要受到外部表查询的影响，</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>username<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> username <span class="token keyword">from</span> tdep a <span class="token keyword">where</span> a<span class="token punctuation">.</span>id<span class="token operator">=</span>b<span class="token punctuation">.</span>dep<span class="token punctuation">)</span> <span class="token keyword">from</span> tuser b<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+-------------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type        <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+-------------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>            <span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>        <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DEPENDENT SUBQUERY <span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> study<span class="token punctuation">.</span>b<span class="token punctuation">.</span>dep <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------------+-------+------------+--------+---------------+---------+---------+-------------+------+----------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="union"><a href="#union" class="header-anchor">#</a> union</h3> <p><code>union</code> 连接的两个 <code>select</code> 查询，第一个查询是 <code>PRIMARY</code> ，除了第一个表外，第二个以后的表<code>select_type</code>都是<code>union</code></p> <h3 id="dependent-union"><a href="#dependent-union" class="header-anchor">#</a> dependent union</h3> <p>与<code>union</code>一样，出现在<code>union</code> 或<code>union all</code>语句中，但是这个查询要受到外部查询的影响，例如下面的子查询的结果会作为主查询的条件被关联起来，因此产生 <code>dependent union</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> explain <span class="token keyword">select</span> * from tuser where sex <span class="token keyword">in</span> <span class="token punctuation">(</span>select sex from tuser where <span class="token assign-left variable">sex</span><span class="token operator">=</span><span class="token string">'1'</span> union <span class="token keyword">select</span> sex from tuser where <span class="token assign-left variable">sex</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
+----+--------------------+------------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span> select_type        <span class="token operator">|</span> table      <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token builtin class-name">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> key              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> rows <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
+----+--------------------+------------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> PRIMARY            <span class="token operator">|</span> tuser      <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL   <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL             <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> Using where              <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> DEPENDENT SUBQUERY <span class="token operator">|</span> tuser      <span class="token operator">|</span> NULL       <span class="token operator">|</span> index <span class="token operator">|</span> NULL          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> NULL <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> Using where<span class="token punctuation">;</span> Using index <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> DEPENDENT UNION    <span class="token operator">|</span> tuser      <span class="token operator">|</span> NULL       <span class="token operator">|</span> index <span class="token operator">|</span> NULL          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> NULL <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> Using where<span class="token punctuation">;</span> Using index <span class="token operator">|</span>
<span class="token operator">|</span> NULL <span class="token operator">|</span> UNION RESULT       <span class="token operator">|</span> <span class="token operator">&lt;</span>union2,<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> <span class="token operator">|</span> NULL       <span class="token operator">|</span> ALL   <span class="token operator">|</span> NULL          <span class="token operator">|</span> NULL             <span class="token operator">|</span> NULL    <span class="token operator">|</span> NULL <span class="token operator">|</span> NULL <span class="token operator">|</span>     NULL <span class="token operator">|</span> Using temporary          <span class="token operator">|</span>
+----+--------------------+------------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="union-result"><a href="#union-result" class="header-anchor">#</a> union result</h3> <p>包含 <code>union</code> 的结果集，在<code>union</code>和<code>union all</code>语句中,因为它不需要参与查询，所以<code>id</code>字段为<code>null</code></p> <h3 id="derived"><a href="#derived" class="header-anchor">#</a> derived</h3> <p><code>from</code>字句中出现的子查询，也叫做派生表，其他数据库中可能叫做内联视图或嵌套select,<code>MYSQL 5.7</code> 后，<code>from</code> 子句中出现的子查询，并不会被识别为 <code>derived</code> ，而是 <code>simple</code>.</p> <h2 id="table"><a href="#table" class="header-anchor">#</a> table</h2> <p><code>table</code> 字段表示的是，当前 <code>SQL</code> 语句是在哪张表上执行的：</p> <ul><li>显示的查询表名，如果查询使用了别名，那么这里显示的是别名</li> <li>如果不涉及对数据表的操作，那么这显示为<code>null</code></li> <li>如果显示为尖括号括起来的就表示这个是临时表，后边的N就是执行计划中的id，表示结果来自于这个查询产生。</li> <li>如果是尖括号括起来的<code>&lt;union M,N&gt;</code>，与类似，也是一个临时表，表示这个结果来自于 <code>union</code> 查询的<code>id</code>为<code>M,N</code>的结果集。</li></ul> <h2 id="type-重要"><a href="#type-重要" class="header-anchor">#</a> type 💥 重要</h2> <p><code>type</code> 是一个十分重要的性能指标，<strong style="color:#3EAF7C;">它直接表明了我们的 SQL 语句是否有使用到索引</strong>。以下列出 <code>type</code> 的所有值，并按照性能依次排序：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>system，const，eq_ref，ref，fulltext，ref_or_null，unique_subquery，index_subquery，range，index_merge，index，ALL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这些指标中，<strong style="color:#3EAF7C;">除了 <code>all</code> 之外的，都能够用到索引，并且除了 <code>index_merge</code> 之外，都只能使用一个索引</strong>。</p> <div class="custom-block tip"><p class="custom-block-title">建议</p> <p>索引最低也要使用到 <code>range</code> 级别。</p></div> <h3 id="system"><a href="#system" class="header-anchor">#</a> system</h3> <p>当表中只有一行数据或者是空表的时候，就会显示 <code>system</code> 。</p> <div class="custom-block tip"><p class="custom-block-title">其它版本</p> <p>测试版本 5.7.29 就算是空表查出来也不是 <code>system</code></p></div> <p><img src="/mysql_img/system.jpg" alt="img"></p> <h3 id="const-重要"><a href="#const-重要" class="header-anchor">#</a> const 👍 重要</h3> <p>当使用<code>主键索引</code>或<code>唯一索引</code>时，返回的记录数一定是一条，并且是等值的 <code>where</code> 条件时，通常显示 <code>const</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> test <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> test  <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="eq-ref-重要"><a href="#eq-ref-重要" class="header-anchor">#</a> eq_ref 👍 重要</h3> <p>当进行关联查询时，如果关联的条件是<code>主键</code>或者<code>唯一索引</code>进行一对一的关联时，就会出现 <code>eq_ref</code>。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser<span class="token punctuation">,</span>tdep <span class="token keyword">where</span> tuser<span class="token punctuation">.</span>id <span class="token operator">=</span> tdep<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>   <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref           <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tdep  <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>    <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> eq_ref <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> study<span class="token punctuation">.</span>tdep<span class="token punctuation">.</span>id <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="ref-重要"><a href="#ref-重要" class="header-anchor">#</a> ref 👍 重要</h3> <p><code>ref</code> 通常出现在使用了<code>非唯一索引</code>的等值查询、<code>等值非主键</code>查询或满足<code>最左前缀</code>的组合索引查询中。<strong style="color:#3EAF7C;">需要注意的是，当使用非唯一索引进行查询时，若查询条件过滤出来的数据量超过了总数据量的 1/3，会使得索引失效，从而走全表扫描</strong></p> <p><strong>非唯一索引情况</strong>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> dep<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_dep       <span class="token operator">|</span> idx_dep <span class="token operator">|</span> <span class="token number">5</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+---------+---------+-------+------+----------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>等值非主键连接</strong>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> a<span class="token punctuation">.</span>id <span class="token keyword">from</span> tuser a <span class="token keyword">left</span> <span class="token keyword">join</span> tdep b <span class="token keyword">on</span> a<span class="token punctuation">.</span>username<span class="token operator">=</span>b<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref              <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>             <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref   <span class="token operator">|</span> username      <span class="token operator">|</span> username         <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> study<span class="token punctuation">.</span>a<span class="token punctuation">.</span>username <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>注意，这里 <code>on</code> 条件的两边都需要创建索引，否则都会导致有一边进行全表扫描</p></div> <p><strong>最左前缀规则</strong>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'zhf'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="fulltext"><a href="#fulltext" class="header-anchor">#</a> fulltext</h3> <p>全文索引检索，要注意，<strong style="color:#3EAF7C;">全文索引的优先级很高，若全文索引和普通索引同时存在时，mysql不管代价，优先选择使用全文索引</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> taddr <span class="token keyword">where</span> <span class="token keyword">match</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span> against<span class="token punctuation">(</span><span class="token string">'bei'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+----------+---------------+---------+---------+-------+------+----------+-------------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>     <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+----------+---------------+---------+---------+-------+------+----------+-------------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> taddr <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> fulltext <span class="token operator">|</span> ft_addr       <span class="token operator">|</span> ft_addr <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> Ft_hints: sorted <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+----------+---------------+---------+---------+-------+------+----------+-------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="ref-or-null"><a href="#ref-or-null" class="header-anchor">#</a> ref_or_null</h3> <p>与 <code>ref</code> 方法类似，只是增加了null值的比较。实际用的不多。</p> <h3 id="unique-subquery"><a href="#unique-subquery" class="header-anchor">#</a> unique_subquery</h3> <p>用于where中的in形式子查询，子查询返回不重复值唯一值</p> <h3 id="index-subquery"><a href="#index-subquery" class="header-anchor">#</a> index_subquery</h3> <p>用于 <code>in</code> 形式子查询使用到了辅助索引或者in常数列表，子查询可能返回重复值，可以使用索引将子查询去重。</p> <h3 id="range-重要"><a href="#range-重要" class="header-anchor">#</a> range 💥 重要</h3> <p><code>range</code> 出现在用索引进行范围查询的情况中，通常随着关键字 <code>&gt;</code> ,<code>&lt;</code> ,<code>is null</code> ,<code>between</code> ,<code>in</code> ,<code>like</code>等运算符的查询中。</p> <p>例如主键范围查询：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> id <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token keyword">PRIMARY</span> <span class="token operator">|</span> <span class="token number">4</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong style="color:#3EAF7C;">当使用 <code>%</code> 号时，如果是使用 <code>常量%</code>，才能使用到索引，如果使用 <code>%常量</code> ，是无法使用索引的，</strong>因为需要逐个比较才可以 ：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- % 在后面</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'z%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- % 在前面</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'%z%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="index-重要"><a href="#index-重要" class="header-anchor">#</a> index 👍 重要</h3> <p><code>index</code> 主要是当使用了<strong style="color:#3EAF7C;">覆盖索引</strong>的时候就会体现出来。例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> username <span class="token keyword">from</span> tuser<span class="token punctuation">;</span>          
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="all-重要"><a href="#all-重要" class="header-anchor">#</a> all 👍 重要</h3> <p><code>all</code> 是所有索引情况中最慢的一个了，因为它要走的是<strong style="color:#3EAF7C;">全表扫描</strong>，也就是遍历主键索引树上的所有数据，全部返回到 <code>server</code> 层中，读取到内存里，并根据 <code>where</code> 条件进行过滤判断，如果不符合，则取下一条记录判断。</p> <h2 id="possible-keys"><a href="#possible-keys" class="header-anchor">#</a> possible keys</h2> <p>这一列表示的是，这次查询中<strong style="color:#3EAF7C;">可能</strong>会用到的索引。</p> <h2 id="key"><a href="#key" class="header-anchor">#</a> key</h2> <p>这一列表示这次查询中<strong style="color:#3EAF7C;">实际上</strong>用到的索引</p> <h2 id="key-len"><a href="#key-len" class="header-anchor">#</a> key len</h2> <p>这一列表示这次查询中，使用到的索引的长度，因为组合索引不一定会被全部用完，所以长度会不一样</p> <p>另外，<code>key_len</code> 只计算 <code>where</code> 条件用到的索引长度，而排序和分组就算用到了索引，也不会计算到<code>key_len</code>中。</p> <h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <p><code>ref</code> 表示查询条件中关联了哪些值：</p> <ul><li>如果是使用的常数等值查询，这里会显示 <code>const</code></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'zhangfei'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">308</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>如果是连接查询，被驱动表的执行计划这里会显示驱动表的关联字段</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- ref 关联了 study.a.username</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> a<span class="token punctuation">.</span>id <span class="token keyword">from</span> tuser a <span class="token keyword">left</span> <span class="token keyword">join</span> tdep b <span class="token keyword">on</span> a<span class="token punctuation">.</span>username<span class="token operator">=</span>b<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref              <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>             <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref   <span class="token operator">|</span> username      <span class="token operator">|</span> username         <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> study<span class="token punctuation">.</span>a<span class="token punctuation">.</span>username <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------------------+------+----------+-------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>如果是条件使用了表达式或者函数，或者条件列发生了内部隐式转换，这里可能显示为func</li></ul> <h2 id="rows"><a href="#rows" class="header-anchor">#</a> rows</h2> <p><code>row</code> 表示 <code>Server</code> 层找存储引擎层拿到的记录数，也可以是执行计划中估算的扫描行数，不是精确值（InnoDB不是精确的值，MyISAM是精确的值，主要原
因是InnoDB里面使用了MVCC并发机制）</p> <h2 id="filtered"><a href="#filtered" class="header-anchor">#</a> filtered</h2> <p>5.7之后的版本默认就有这个字段，不需要使用explain extended了。这个字段表示存储引擎返回的数据在server层过滤后，剩下多少满足查询的记录数量的比例，注意是百分比，不是具体记录数。</p> <h2 id="extra-重要"><a href="#extra-重要" class="header-anchor">#</a> extra 💥 重要</h2> <p>这个列的信息主要是描述 SQL 语句的很多补充信息，例如索引下推、是否使用临时表等。下面列举常用的：</p> <h3 id="no-tables-used"><a href="#no-tables-used" class="header-anchor">#</a> no tables used</h3> <p>这个信息表示没有 <code>From</code> 子句的查询。</p> <h3 id="using-filesort"><a href="#using-filesort" class="header-anchor">#</a> using filesort</h3> <p>当使用 <code>order by</code> 或者 <code>group by</code> 进行分组或排序时，若无法使用到索引，就会出现 <code>using filesort</code> ,表示只能通过文件进行排序，<strong style="color:#3EAF7C;">换句话说，这个排序也是在 server 层实现的，先把所有数据取出来，再一条条的去排序</strong>。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> taddr <span class="token keyword">order</span> <span class="token keyword">by</span> addr<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> taddr <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> filesort <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="using-index"><a href="#using-index" class="header-anchor">#</a> using index</h3> <p>这个信息表示查询的时候不需要进行<strong style="color:#3EAF7C;">回表</strong>，也就是说，使用到覆盖索引了。</p> <p>但是，如果同时出现 <code>Using Where</code> ，说明索引被用来执行查找索引键值了，例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> username<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex <span class="token keyword">from</span> tuser <span class="token keyword">where</span> age <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">33.33</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这里的 <code>age</code> 并无法使用组合索引，因此会将数据返回给 <code>server</code> 层进行过滤，所以出现了 <code>using where</code></p> <h3 id="using-temporary"><a href="#using-temporary" class="header-anchor">#</a> using temporary</h3> <p>这个表示使用到了临时表，通常是在内存中创建一张表，暂时存储记录，例如以下情况：</p> <ul><li>MySQL在对查询结果 <code>order by</code> 和 <code>group by</code> 时使用临时表</li> <li>临时表可以是内存临时表和磁盘临时表，执行计划中看不出来，需要查看 <code>status</code>变量，<code>used_tmp_table</code>，<code>used_tmp_disk_table</code>才能看出来。</li> <li>使用 <code>distinct</code> 关键字，此时会生成一张一模一样的表，再一条条的去过滤。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这种查询效率并不高</p></div> <h3 id="using-where-重要"><a href="#using-where-重要" class="header-anchor">#</a> using where 💥 重要</h3> <p>这个信息表示返回的结果集并不是都满足查询条件，需要在 <code>server</code> 层过滤，<strong style="color:#3EAF7C;">十分影响性能</strong>。而且，一旦出现了 <code>using where</code> ,基本上就没怎么用到索引了。</p> <p>Using where表示MySQL将对存储引擎层提取的结果进行过滤，过滤条件字段无索引。例如：select * from test where age &gt; 30; 所以，Using where本身其实和是否使用索引无关，它表示的是Server层对存储引擎层返回的数据所做的过滤。<strong style="color:#3EAF7C;">当然该过滤可能会回表，也可能不会回表，取决于查询字段是否被索引覆盖。</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> sex<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="using-index-condition-重要"><a href="#using-index-condition-重要" class="header-anchor">#</a> using index condition 💥 重要</h3> <p>这个信息表示使用到了 <strong style="color:#3EAF7C;">索引下推</strong>，这是 <code>mysql 5.6</code> 之后新增的特性，称为 <code>ICP</code>，在 5.6 之前，由于组合索引碰到范围查询之后的就会失效，因此 <code>age=20</code> 会导致查询出所有满足 <code>zhang%</code> 的数据，然后回到 <code>server</code> 根据 <code>age=20</code> 进行过滤。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'zhang%'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">308</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="mysql-索引失效分析"><a href="#mysql-索引失效分析" class="header-anchor">#</a> MySQL 索引失效分析</h2> <p>口诀:</p> <p><img src="/mysql_img/koujue.png" alt="img"></p> <h3 id="全局匹配我最爱"><a href="#全局匹配我最爱" class="header-anchor">#</a> 全局匹配我最爱</h3> <p>对于组合索引，如果全部索引都用到了，是不可能会失效的。</p> <h3 id="最佳左前缀法则"><a href="#最佳左前缀法则" class="header-anchor">#</a> 最佳左前缀法则</h3> <p>对于组合索引来说，带头索引不能死，中间索引不能断，例如存在组合索引 <code>(name, age, sex)</code>, 如果在查询时：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这样是无法使用索引的，因为组合索引的带头大哥 <code>name</code> 都没有使用到。</p> <p>而且中间索引也不能断，不然索引的使用会不完整，例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'zhangfei'</span> <span class="token operator">and</span> sex <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>   
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这里因为 <code>age</code> 索引没用到，因此 <code>sex</code> 索引也是用不到的，但是可以触发索引下推 <code>using index condition</code>.</p> <h3 id="不要在索引上做计算"><a href="#不要在索引上做计算" class="header-anchor">#</a> 不要在索引上做计算</h3> <p>如果在索引上进行计算、函数、自动/手动类型转换，都会导致索引失效而转向全表扫描</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> <span class="token keyword">left</span><span class="token punctuation">(</span>loginname<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'zy'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对 <code>sex</code> 做了隐式转换，导致<code>sex</code> 索引无法被使用：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'zhangfei'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">and</span> sex<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">308</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'zhangfei'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">and</span> sex<span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------------------+---------+-------------------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="范围条件右边的列失效"><a href="#范围条件右边的列失效" class="header-anchor">#</a> 范围条件右边的列失效</h3> <p>在组合索引中，即使所有的索引我们都使用到了，但是如果中间某个索引使用了范围查询，则会使得后面的索引失效，不过可以触发索引下推：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'zhang%'</span> <span class="token operator">and</span> age<span class="token operator">&gt;</span><span class="token number">20</span> <span class="token operator">and</span> sex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">308</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这里的 <code>sex</code> 字段是没有使用到索引的，具体可以通过 <code>key_len</code> 观察到</p> <h3 id="尽量使用覆盖索引"><a href="#尽量使用覆盖索引" class="header-anchor">#</a> 尽量使用覆盖索引</h3> <p>当写 SQL 通过 <code>select *</code> 时，通常会触发回表或者是全表扫描等影响性能的行为，因此尽量使用覆盖索引来防止这些索引失效。例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 没有使用到覆盖索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment">-- 使用到覆盖索引</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> username<span class="token punctuation">,</span>age<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>id <span class="token keyword">from</span> tuser<span class="token punctuation">;</span> 
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+-------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="索引字段上不要使用不等"><a href="#索引字段上不要使用不等" class="header-anchor">#</a> 索引字段上不要使用不等</h3> <p>索引字段上使用（！= 或者 &lt; &gt;）判断时，会导致索引失效而转向全表扫描</p> <blockquote><p>注：主键索引会使用范围索引，辅助索引会失效</p></blockquote> <p>因为通过使用 <code>!=</code>、<code>&gt;</code>、<code>&lt;</code> 时，会导致数据量超过 <code>1/3</code> ，从而导致索引失效</p> <h3 id="主键索引上不能使用带有-null-的判断"><a href="#主键索引上不能使用带有-null-的判断" class="header-anchor">#</a> 主键索引上不能使用带有 null 的判断</h3> <p>在主键上，不能判断 <code>is null</code> 或者 <code>is not null</code>, 这样都会无法使用到索引。</p> <h3 id="索引字段使用like不以通配符开头"><a href="#索引字段使用like不以通配符开头" class="header-anchor">#</a> 索引字段使用like不以通配符开头</h3> <p>对于索引字段，如果使用 <code>%</code>、<code>_</code> 开头的话，都会导致索引失效，从而变为全表扫描。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tdep <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'%rong'</span><span class="token punctuation">;</span>           
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tdep  <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tdep <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'rong%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>      <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tdep  <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> username      <span class="token operator">|</span> username <span class="token operator">|</span> <span class="token number">303</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>由结果可知，<code>like</code> 以通配符结束相当于范围查找，索引不会失效。<strong style="color:#3EAF7C;">与范围条件（bettween、&lt;、&gt;、in等）不同的是：不会导致右边的索引失效</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- age 和 sex 还是有使用到索引， ken_len 的值是 312</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'rong%'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">and</span> sex <span class="token operator">=</span>  <span class="token string">'1'</span><span class="token punctuation">;</span>   
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果想要 <code>%aaa%</code> 这样的形式，也要使用到索引怎么办呢？可以通过覆盖索引实现。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> username <span class="token punctuation">,</span> age<span class="token punctuation">,</span>sex <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'%a%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">index</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">312</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+---------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="索引字段是字符串需要带单引号"><a href="#索引字段是字符串需要带单引号" class="header-anchor">#</a> 索引字段是字符串需要带单引号</h3> <p>例如这里的 <code>sex</code> 字段是 <code>char</code> 值，如果在查询时设置 <code>sex=1</code> 而不是 <code>sex='1'</code>，就会导致 <code>sex</code> 字段被进行隐式转换，从而使索引失效</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>
mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> username <span class="token punctuation">,</span> age<span class="token punctuation">,</span>sex <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username <span class="token operator">like</span> <span class="token string">'a%'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">and</span> sex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>              <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> range <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token number">308</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>    <span class="token number">14.29</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+-------+------------------+------------------+---------+------+------+----------+--------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="索引字段不要使用or"><a href="#索引字段不要使用or" class="header-anchor">#</a> 索引字段不要使用or</h3> <p>对不同的索引字段之间使用 <code>or</code> 也会导致索引失效：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'asd'</span> <span class="token operator">or</span> age<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys    <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tuser <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_name_age_sex <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span>    <span class="token number">26.53</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+------------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token keyword">sql</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>不同版本之间得到的结果是不一样的！！！！</p></div> <p>在 <code>mysql5.6</code> 版本，这样的语句也是用不了索引的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'asd'</span> <span class="token operator">or</span> username<span class="token operator">=</span><span class="token string">'zhangfei'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是可以通过 <code>union</code> 优化：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'asd'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tuser <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'zhangfei'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2020-3-17 9:00:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database/RDB/MySQL_Learn/MySQL索引.html" class="prev">
        MySQL 索引
      </a></span> <span class="next"><a href="/database/RDB/MySQL_Learn/MySQL锁.html">
        MySQL 锁
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78cba7d9.js" defer></script><script src="/assets/js/2.b97de27f.js" defer></script><script src="/assets/js/11.fc6bddf2.js" defer></script>
  </body>
</html>
