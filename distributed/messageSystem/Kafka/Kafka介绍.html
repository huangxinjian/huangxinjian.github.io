<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka 介绍 | HuangXinJian</title>
    <meta name="description" content="If you learn, learn deeply please!">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/H.png">
    
    <link rel="preload" href="/assets/css/0.styles.77838d5e.css" as="style"><link rel="preload" href="/assets/js/app.78cba7d9.js" as="script"><link rel="preload" href="/assets/js/2.b97de27f.js" as="script"><link rel="preload" href="/assets/js/19.687638f3.js" as="script"><link rel="prefetch" href="/assets/js/10.5a39f9cf.js"><link rel="prefetch" href="/assets/js/11.fc6bddf2.js"><link rel="prefetch" href="/assets/js/12.da1eaab3.js"><link rel="prefetch" href="/assets/js/13.3e791f4e.js"><link rel="prefetch" href="/assets/js/14.5953a388.js"><link rel="prefetch" href="/assets/js/15.b9e792e3.js"><link rel="prefetch" href="/assets/js/16.14be3228.js"><link rel="prefetch" href="/assets/js/17.d8c48abe.js"><link rel="prefetch" href="/assets/js/18.c1171d86.js"><link rel="prefetch" href="/assets/js/20.dbb7c712.js"><link rel="prefetch" href="/assets/js/21.fcac9d7b.js"><link rel="prefetch" href="/assets/js/22.05c89a82.js"><link rel="prefetch" href="/assets/js/23.6f455ef9.js"><link rel="prefetch" href="/assets/js/24.a5f5dd42.js"><link rel="prefetch" href="/assets/js/25.ddacf5f1.js"><link rel="prefetch" href="/assets/js/26.1dbabccd.js"><link rel="prefetch" href="/assets/js/27.4d3ddddd.js"><link rel="prefetch" href="/assets/js/28.aca93b2e.js"><link rel="prefetch" href="/assets/js/29.4e592fcf.js"><link rel="prefetch" href="/assets/js/3.8c3b122e.js"><link rel="prefetch" href="/assets/js/30.07e05cf0.js"><link rel="prefetch" href="/assets/js/31.4bc393d7.js"><link rel="prefetch" href="/assets/js/32.5bed9ede.js"><link rel="prefetch" href="/assets/js/33.b1d61159.js"><link rel="prefetch" href="/assets/js/34.27c7f1f1.js"><link rel="prefetch" href="/assets/js/35.17c92a26.js"><link rel="prefetch" href="/assets/js/36.91a5ecf5.js"><link rel="prefetch" href="/assets/js/37.88c250af.js"><link rel="prefetch" href="/assets/js/38.6d72295b.js"><link rel="prefetch" href="/assets/js/39.0e585af1.js"><link rel="prefetch" href="/assets/js/4.ff5f2a88.js"><link rel="prefetch" href="/assets/js/40.80a7f1c2.js"><link rel="prefetch" href="/assets/js/41.defa3efa.js"><link rel="prefetch" href="/assets/js/42.70857ada.js"><link rel="prefetch" href="/assets/js/5.68065b24.js"><link rel="prefetch" href="/assets/js/6.bb2aa06c.js"><link rel="prefetch" href="/assets/js/7.f469350c.js"><link rel="prefetch" href="/assets/js/8.37ca51cf.js"><link rel="prefetch" href="/assets/js/9.68f4fa83.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77838d5e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HuangXinJian</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/NodeJS基础/NodeJS介绍.html" class="nav-link">
  NodeJS 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/baseJava/Java 介绍.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/frameworkHistory/架构演变历史.html" class="nav-link">
  分布式学习路线
</a></li><li class="dropdown-item"><!----> <a href="/distributed/registerCenter/" class="nav-link">
  注册中心
</a></li><li class="dropdown-item"><!----> <a href="/distributed/messageSystem/" class="nav-link router-link-active">
  消息系统
</a></li><li class="dropdown-item"><!----> <a href="/distributed/internal/" class="nav-link">
  网络框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/RDB/MySQL_Learn/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxinjian/huangxinjian.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NodeJS" class="dropdown-title"><span class="title">NodeJS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/NodeJS基础/NodeJS介绍.html" class="nav-link">
  NodeJS 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/baseJava/Java 介绍.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><span class="title">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/distributed/frameworkHistory/架构演变历史.html" class="nav-link">
  分布式学习路线
</a></li><li class="dropdown-item"><!----> <a href="/distributed/registerCenter/" class="nav-link">
  注册中心
</a></li><li class="dropdown-item"><!----> <a href="/distributed/messageSystem/" class="nav-link router-link-active">
  消息系统
</a></li><li class="dropdown-item"><!----> <a href="/distributed/internal/" class="nav-link">
  网络框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          关系型数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/RDB/MySQL_Learn/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/huangxinjian/huangxinjian.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/distributed/messageSystem/" class="sidebar-link">消息系统介绍</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/distributed/messageSystem/Kafka/Kafka介绍.html" class="active sidebar-link">Kafka 介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#kafka-的系统架构" class="sidebar-link">kafka 的系统架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#zookeeper-for-kafka" class="sidebar-link">Zookeeper for Kafka</a></li></ul></li><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#kafka-使用场景" class="sidebar-link">Kafka 使用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#用户追踪" class="sidebar-link">用户追踪</a></li><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#日志聚合" class="sidebar-link">日志聚合</a></li><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#限流削锋" class="sidebar-link">限流削锋</a></li></ul></li><li class="sidebar-sub-header"><a href="/distributed/messageSystem/Kafka/Kafka介绍.html#kakfa-的高吞吐率实现" class="sidebar-link">Kakfa 的高吞吐率实现</a></li></ul></li><li><a href="/distributed/messageSystem/Kafka/Kafka安装.html" class="sidebar-link">Kafka 集群搭建</a></li><li><a href="/distributed/messageSystem/Kafka/KafkaAPI使用.html" class="sidebar-link">Kafka API 使用教程</a></li></ul></section></li><li><a href="/distributed/messageSystem/RabbitMQ/" class="sidebar-link">RabbitMQ</a></li><li><a href="/distributed/messageSystem/RocketMQ/" class="sidebar-link">RocketMQ</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kafka-介绍"><a href="#kafka-介绍" class="header-anchor">#</a> Kafka 介绍</h1> <p>Kafka 是由 Apache 开发的一款快速、可伸缩、持久且具有容错能力的发布-订阅消息系统。与其他消息系统（RocketMQ、RabbitMQ）相比，Kafka 的高吞吐率是它最大的一个特点。</p> <h2 id="kafka-的系统架构"><a href="#kafka-的系统架构" class="header-anchor">#</a> kafka 的系统架构</h2> <p>kafka 由 <code>Records(记录)</code>、<code>Topics(主题)</code>、<code>Consumers(消费者)</code>、<code>Producers(生产者)</code>、<code>Brokers(中间人)</code>、<code>Logs(日志)</code>、<code>Partitions(分区)</code>还有<code>Clusters(集群)</code>组成。</p> <p>其架构图如下：</p> <p><img src="/images/kafkaArch.jpg" alt="kafkaarch"></p> <p>可以看到，Kafka 的定位是一个中间消息系统，通过一个 <code>input System</code> 输入消息给 Kafka，这个 Input System 对应了 Kafka 的使用场景，例如日志聚合、用户活动追踪、批量导入、Web 日志等。</p> <p>当 kafka 接受到这些数据后，可以输出给一些 <code>Ouput System</code>，例如数据分析、数据库、机器学习、Dashboards、搜索索引等</p> <p>而在中间的 <code>Apache Core Kafka</code> 中，可以看到，Kakfa 需要依赖 Zookeeper 的一些功能。下面来讲一下 Zookeeper 在 kafka 中的作用</p> <h3 id="zookeeper-for-kafka"><a href="#zookeeper-for-kafka" class="header-anchor">#</a> Zookeeper for Kafka</h3> <blockquote><p>Kafka uses Zookeeper to do leadership election of Kafka Broker and Topic Partition pairs. Kafka uses Zookeeper to manage service discovery for Kafka Brokers that form the cluster. Zookeeper sends changes of the topology to Kafka, so each node in the cluster knows when a new broker joined, a Broker died, a topic was removed or a topic was added, etc. Zookeeper provides an in-sync view of Kafka Cluster configuration.</p></blockquote> <p>在 Kafka 中，有内置好的 Zookeeper 提供我们使用，不过我们通常会使用外部的自己配置的一台 Zookeeper 服务器，它的作用如下：</p> <ul><li>Kafka 使用 Zookeeper 进行 <code>Kafka Broker</code> 和 <code>Topic Partition Pairs</code> 的领导选择</li> <li>Kafka 使用 Zookeeper 管理形成集群的 <code>Kafka Broker</code> 的服务发现</li> <li>Zookeeper 提供了 Kafka 集群配置的同步视图 <code>ISR</code></li></ul> <h2 id="kafka-使用场景"><a href="#kafka-使用场景" class="header-anchor">#</a> Kafka 使用场景</h2> <p>Kafka 的应用场景有很多，下面讲解一下最常用的三个场景</p> <h3 id="用户追踪"><a href="#用户追踪" class="header-anchor">#</a> 用户追踪</h3> <p>用户在网站中不同的消息活动发送到不同的消息主题中，然后可以对这些消息进行实时监测、实时处理。还可以将这些消息存入到 spark、hadoop 中</p> <h3 id="日志聚合"><a href="#日志聚合" class="header-anchor">#</a> 日志聚合</h3> <p>Kafka 最初的定位也是用来处理海量日志的，其架构图如下, 日志采集应用将日志输入到 kafka 中，日志处理应用再从 kafka 中获取日志处理。</p> <p><img src="/images/kafkalog.jpg" alt="kafkalog"></p> <h3 id="限流削锋"><a href="#限流削锋" class="header-anchor">#</a> 限流削锋</h3> <p>对于大型秒杀活动，可以先将用户的请求存入到 kafka 中，再由秒杀处理系统读取这些请求进行处理</p> <p><img src="/images/kafkapeekclipping.png" alt="kafkapeekclipping"></p> <h2 id="kakfa-的高吞吐率实现"><a href="#kakfa-的高吞吐率实现" class="header-anchor">#</a> Kakfa 的高吞吐率实现</h2> <p>上面我们说过，Kafka 对比其他的消息系统来说，最大的特点就是 <strong>“高吞吐率”</strong>，但是 kafka 存储数据却是存在低速硬盘上的，所以必定在 I/O 方面是很慢的，那么为什么 kafka 还会具备这样的特性呢？原因有四点：</p> <ol><li>零拷贝：kafka中的生产者和消费者 是通过 <code>Zero Copy</code> 来操作数据的</li> <li>顺序读写：kafka 将消息存储在分区 <code>partition</code> 中，而分区中的消息是按顺序存放的。</li> <li>批量添加：kafka 对消息会先进行一个缓存，当到达一定大小后，才会接受到 <code>broker</code> 中</li> <li>数据压缩：因为可以批量处理，所以可以对消息进行更好的压缩</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2020-2-21 11:39:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/distributed/messageSystem/" class="prev router-link-active">
        消息系统介绍
      </a></span> <span class="next"><a href="/distributed/messageSystem/Kafka/Kafka安装.html">
        Kafka 集群搭建
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78cba7d9.js" defer></script><script src="/assets/js/2.b97de27f.js" defer></script><script src="/assets/js/19.687638f3.js" defer></script>
  </body>
</html>
